# rsupport-notice-api
RSUPPORT 과제 테스트입니다.

## 사용 기술 스택
- Spring Framework / Boot
- Spring Data JPA / Redis
- Spring Security
- MySQL 8.0
- Redis 6.2.6

## 요구사항 분석 및 해결 전략
### 공지사항 CRUD
기본적인 공지사항 CRUD가 요구되기 때문에 Spring Data JPA를 활용하였습니다. 특별한 데이터베이스 요구사항이 없었기 때문에 ORM으로 데이터베이스에 접근하면서 Data Repository를 활용하여 생산성을 높였습니다.

공지사항 등록 시 입력 항목은 제목, 내용, 공지 시작/종료일시, 첨부파일을 받기 때문에 첨부 파일을 제외한 나머지 항목에 대하여 스프링에서 지원하는 Jakarta Validation을 이용하여 컨트롤러에서 일차적으로 입력값을 검증하였습니다. 이후 최종 단계인 도메인 클래스에서도 스프링의 Assert 클래스를 이용하여 한번 더 검증하였습니다. 첨부파일은 별도로 파일 전용 API를 통해 업로드하고 게시글 작성 시 업로드된 파일의 식별자를 첨부하여 보내는 방식으로 구현했습니다. 

공지사항 조회 시 응답은 제목, 내용, 등록일시, 조회수, 작성자를 요구하기 때문에 공지사항 등록 시 JPA Auditing 기능을 이용하여 생성일을 기록하였습니다. 작성자는 JWT를 이용하여 인증된 사용자만 공지사항을 등록 및 수정하도록 구현하였습니다. 관련 요구사항은 정의되지 않았기 때문에 별도의 사용자 계정 CRUD 없이 In-memory에 등록된 계정으로만 인증하도록 했습니다.

### 파일 업로드, 다운로드
파일 기능은 두 가지(로컬, 원격) 버전이 있으며 현재는 원격 버전으로 적용되어 있습니다.

먼저 로컬 버전에서는 파일 참조 시 서버 파일 시스템 정보를 노출하지 않기 위해 파일에 직접 접근하지 않고 식별자를 통해서만 접근하는 방식으로 구현하였습니다. 식별자는 해당 파일의 MD5 해시값을 사용하였으며 동일한 해시값을 가진 파일이 이미 업로드된 경우 다시 업로드하지 않고 기존의 파일을 반환하도록 구성했습니다.

현재 적용된 원격 버전에서는 [Cloudinary](https://cloudinary.com/) 라는 외부 서비스를 이용하여 파일 저장소로 활용하고 있습니다. 무료 버전의 경우 25GB 까지 스토리지를 제공하기 때문에 현재 과제 테스트 용으로는 충분하다고 생각하여 적용하였습니다. 로컬 버전보다는 느리지만 서버 애플리케이션과 동일한 환경에 파일을 업로드하고 직접 제공한다면 확장성 측면에서 불리하다고 생각하기 때문에 이처럼 구현하였습니다.

### 공지사항 조회수
게시글의 조회수는 매 조회마다 변경되어야 하기 때문에 RDB에 매번 쓰기 연산을 수행하는 것은 부담이 될 수 있습니다. 그래서 NoSQL 데이터베이스(Redis)에서 특정 게시글의 조회수를 캐시로 기억해두고 조회 및 쓰기 연산을 처리한 후 일정 규모가 쌓이면 실제 데이터베이스에 반영하는 방식으로 구현하였습니다.

## 테스트 코드
테스트 코드에서는 애플리케이션 기능의 정상 작동, 부적절한 입력값, 부적절한 요청 등 성공 케이스와 실패 케이스를 작성하였습니다.

## 실행 방법
### 환경 설정
#### 실행 환경
기본적으로 애플리케이션을 실행할 시스템에는 Java 11 버전이 설치되어 있어야 합니다. 데이터베이스는 MySQL 8.0 버전과 Redis 최신 버전이 설치되어 있어야 합니다.

실제로 사용하게 될 애플리케이션 프로필은 [prod](./src/main/resources/application-prod.yml) 프로필이며 해당 프로필을 수정하거나 다음처럼 환경 설정을 진행할 수 있습니다.

#### 환경 변수
- ${MYSQL8_JDBC_URL}: 애플리케이션에서 접속할 데이터베이스의 jdbc URL.
- ${MYSQL8_USERNAME}: 애플리케이션에서 접속할 데이터베이스의 사용자 명.
- ${MYSQL8_PASSWORD}: 애플리케이션에서 접속할 데이터베이스의 사용자의 비밀번호.
- ${MYSQL8_JDBC_TEST_URL}: 애플리케이션 빌드 시 사용할 테스트 데이터베이스의 jdbc URL.
- ${MYSQL8_TEST_USERNAME}: 애플리케이션 빌드 시 사용할 테스트 데이터베이스의 사용자 명.
- ${MYSQL8_TEST_PASSWORD}: 애플리케이션 빌드 시 사용할 테스트 데이터베이스의 사용자의 비밀번호.
- ${CLOUDINARY_URL}: Cloudinary 서비스를 이용하기 위한 사용자 API 키. 이는 비밀키기 때문에 메일로 전송해드렸습니다. 
- ${JWT_SECRET}: JWT 서명에 사용할 비밀 키.
- ${SPRING_PROFILES_ACTIVE}: prod

### Gradle 빌드
Gradle 개발 환경을 사용하며 시스템에 설치되어 있지 않은 경우 동봉된 `./gradlew` 또는 `./gradlew.bat` 을 활용하십시오.

위의 환경 설정을 마친 후 기본적인 실행 방법은 다음과 같습니다.
- `./gradlew build` : 애플리케이션 빌드
- `./java -jar ./build/libs/notice-0.0.1-SNAPSHOT.jar` : 애플리케이션 실행

